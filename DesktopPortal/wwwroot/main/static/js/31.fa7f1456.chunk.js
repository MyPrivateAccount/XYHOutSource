webpackJsonp([31],{2067:function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){return console.log("roletableMapStateToProps:",e.role),{activeRole:e.role.activeRole,operInfo:e.role.operInfo,roleSource:e.role.roleSource,appList:e.app.appList,privilegeTreeSource:e.role.privilegeTreeSource,treeSource:e.org.treeSource,checkPrivileges:e.role.checkPrivileges,permissionOrgTree:e.org.permissionOrgTree}}function o(e){return{dispatch:e}}Object.defineProperty(t,"__esModule",{value:!0});var c=r(0),s=r.n(c),p=r(92),h=r(46),d=r(1281),u=r(2068),g=r(120),m=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),f=h.s.Header,v=(h.s.Sider,h.s.Content),k=h.t.SubMenu,y=h.t.ItemGroup,b=h.I.TreeNode,O=(h.A.Option,[{organizationId:"00000000",organizationName:"\u672c\u7ec4\u7ec7"},{organizationId:"11111111",organizationName:"\u5206\u516c\u53f8"},{organizationId:"88888888",organizationName:"\u5168\u90e8"}]),E=function(e){function t(){var e,r,a,l;i(this,t);for(var o=arguments.length,c=Array(o),s=0;s<o;s++)c[s]=arguments[s];return r=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.state={privilegeOrgTreeShow:!0,privilegeOrgTreeDisabled:!0,activePrivilegeItem:"",filialeChecked:!1,curOrgChecked:!1,allChecked:!1},a.handleRoleSlected=function(e){console.log("selected\u89d2\u8272\uff1a",e.selectedKeys,e),a.props.dispatch(Object(d.Q)(e.selectedKeys)),a.props.dispatch(Object(d.N)(e.selectedKeys[0]))},a.handleRoleAdd=function(e){console.log("\u89d2\u8272\u65b0\u589e\uff1a"),a.props.dispatch(Object(d.F)())},a.handlePrivilegeSave=function(e){console.log("\u6743\u9650\u4fdd\u5b58",a.props.checkPrivileges);var t=[],r=a.props.appList,i=a.props.checkPrivileges.checkedPrivilegeItemNodes,n=[];i.map(function(e){var i=t.filter(function(t){return t.applicationId==e.applicationId});if(0==i.length){var a=r.find(function(t){return t.id==e.applicationId}),l={applicationId:a.id,applicationName:a.displayName,permissions:[]};l.permissions.push(e),t.push(l),n.push(a.id)}else i[0].permissions.push(e)}),console.log("\u6743\u9650\u4fdd\u5b58JSON\uff1a",t,n),a.props.dispatch(Object(d.O)({roleId:a.props.activeRole.id,rolePrivilege:t})),a.props.dispatch(Object(d.G)({roleId:a.props.activeRole.id,entity:n}))},a.handleDeleteClick=function(e){console.log("delete role:",e),a.props.dispatch(Object(d.H)(e.id))},a.handlePrivilegeItemSelected=function(e){console.log("\u6743\u9650\u9879\u9009\u4e2d:",e.key),a.setState({activePrivilegeItem:e.key});var t=!1,r=!1,i=!1;for(var n in a.props.checkPrivileges.checkedPrivilegeItemNodes){var l=a.props.checkPrivileges.checkedPrivilegeItemNodes[n];if(l.permissionId==e.key){t=l.organizations.filter(function(e){return"11111111"==e.organizationId}).length>0,r=l.organizations.filter(function(e){return"00000000"==e.organizationId}).length>0,i=l.organizations.filter(function(e){return"88888888"==e.organizationId}).length>0;break}}a.setState({privilegeOrgTreeShow:!i,allChecked:i,curOrgChecked:r,filialeChecked:t,privilegeOrgTreeDisabled:!a.props.checkPrivileges.checkkeys.includes(e.key)})},a.privilegeItemCheckChange=function(e){var t=e.target,r=t.checked,i=t.original;console.log("activePrivilegeItem:",a.state.activePrivilegeItem),console.log("checkChange:"+r,i);var n=a.props.checkPrivileges.checkkeys.slice(),l=a.props.checkPrivileges.checkedPrivilegeItemNodes.slice();if(a.setState({privilegeOrgTreeDisabled:!r}),r)n.push(i.id),l.push({applicationId:i.applicationId,permissionId:i.id,permissionName:i.name,groupName:i.groups,organizations:[]});else{n=n.filter(function(e){return e!=i.id});for(var o=l.length-1;o>-1;o--)if(l[o].permissionId==i.id){l.splice(o,1);break}}a.props.dispatch(Object(d.M)({checkkeys:n,checkedPrivilegeItemNodes:l}))},a.handleOrgPrivilegeTypeChecked=function(e){console.log("e",e);var t=e.target,r=t.checked,i=t.value;console.log("\u9009\u62e9\uff1a\uff0cvalue",r,i),"88888888"==i&&r?a.setState({privilegeOrgTreeShow:!1,filialeChecked:!1,curOrgChecked:!1,allChecked:!0}):(a.setState({privilegeOrgTreeShow:!0,allChecked:!1}),"00000000"==i&&a.setState({curOrgChecked:r}),"11111111"==i&&a.setState({filialeChecked:r}));var n=O.find(function(e){return e.organizationId==i}),l=a.props.checkPrivileges.checkedPrivilegeItemNodes.slice();for(var o in l)if(l[o].permissionId==a.state.activePrivilegeItem){if("88888888"==i)l[o].organizations=r?[n]:[];else if(r)l[o].organizations.push(n);else for(var c=l[o].organizations.length-1;c>-1;c--)if(l[o].organizations[c].organizationId==i){l[o].organizations[c].splice(c,1);break}break}console.log("checkedPrivilegeItemNodes",l),a.props.dispatch(Object(d.M)({checkkeys:a.props.checkPrivileges.checkkeys.slice(),checkedPrivilegeItemNodes:l}))},a.handleOrgOnchecked=function(e,t){var r=t.node.props,i=(r.title,r.eventKey,[]);t.checkedNodes.map(function(e){i.push({organizationId:e.key,organizationName:e.props.title})});var n=a.props.checkPrivileges.checkedPrivilegeItemNodes.slice();for(var l in n)if(n[l].permissionId==a.state.activePrivilegeItem){console.log("\u627e\u5230\u9009\u4e2d\u7684\u5f53\u524d\u6743\u9650\u9879\uff0c\u8bbe\u7f6e\u90e8\u95e8\u5c5e\u6027\u4e3a\uff1a",i),n[l].organizations=i;break}console.log("org tree checkedkeys",e.checked,n);var o=Object.assign({},a.props.checkPrivileges,{checkedPrivilegeItemNodes:n});a.props.dispatch(Object(d.M)(o))},l=r,n(a,l)}return a(t,e),m(t,[{key:"componentWillMount",value:function(){this.props.dispatch(Object(d.L)()),this.props.dispatch(Object(d.K)(this.props.appList)),this.props.dispatch(Object(d.t)("RoleCreate")),this.props.dispatch(Object(d.t)("PublicRoleOper")),this.props.dispatch(Object(d.t)("AuthorizationPermission"))}},{key:"componentWillReceiveProps",value:function(e){}},{key:"handleRoleEdit",value:function(e){console.log("\u89d2\u8272\u7f16\u8f91\uff1a"+JSON.stringify(e)),this.props.dispatch(Object(d.J)(e))}},{key:"getAppIcon",value:function(e){var t="appstore",r=e.applicationType,i=g.a.find(function(e){return e.key===r});return i&&(t=i.icon),t}},{key:"render",value:function(){var e=this,t=this.props.checkPrivileges.checkedPrivilegeItemNodes,r=[];t.map(function(t){t.permissionId==e.state.activePrivilegeItem&&t.organizations.map(function(e){r.push(e.organizationId)})});var i=[];this.props.activeRole.id&&i.push(this.props.activeRole.id);return s.a.createElement("div",{className:"inner-page"},s.a.createElement("div",{className:"left-panel"},s.a.createElement("div",{className:"relative"},s.a.createElement(h.s,null,s.a.createElement(f,null,"\u89d2\u8272\u5217\u8868",s.a.createElement(h.H,{title:"\u65b0\u589e\u89d2\u8272"},"\xa0",s.a.createElement(h.g,{type:"primary",shape:"circle",icon:"plus",onClick:this.handleRoleAdd}))),s.a.createElement(v,{style:{overflowY:"auto",padding:"0"}},s.a.createElement(h.t,{theme:this.state.theme,defaultSelectedKeys:i,onSelect:this.handleRoleSlected,mode:"inline"},this.props.roleSource.map(function(t,r){return s.a.createElement(h.t.Item,{key:t.id,selectedKeys:[e.props.activeRole.id]},e.props.activeRole.id==t.id?s.a.createElement("span",{className:"right-tool-bar"},s.a.createElement(h.H,{title:"\u7f16\u8f91\u89d2\u8272"},s.a.createElement(h.g,{type:"primary",className:"ml-sm",shape:"circle",icon:"edit",size:"small",onClick:function(r){return e.handleRoleEdit(t)}})),s.a.createElement(h.H,{title:"\u5220\u9664\u89d2\u8272"},s.a.createElement(h.w,{title:"\u4f60\u786e\u5b9a\u8981\u5220\u9664\u6b64\u89d2\u8272\u4e48?",onConfirm:function(r){return e.handleDeleteClick(t)},onCancel:null,okText:"\u662f",cancelText:"\u5426"},s.a.createElement(h.g,{type:"primary",className:"ml-sm",shape:"circle",icon:"delete",size:"small"})))):null,s.a.createElement("span",null,t.name))})))))),s.a.createElement("div",{className:"right-panel"},s.a.createElement("div",{className:"relative"},s.a.createElement(h.s,null,s.a.createElement(v,{style:{overflowX:"hidden"}},s.a.createElement(h.z,{gutter:10,style:{height:"100%"}},s.a.createElement(h.k,{span:12,style:{height:"100%"}},s.a.createElement(h.s,{style:{height:"100%"}},s.a.createElement(f,null,"\u5de5\u5177\u6743\u9650",s.a.createElement(h.H,{title:"\u4fdd\u5b58\u5de5\u5177\u6743\u9650"},"\xa0",s.a.createElement(h.g,{type:"primary",shape:"circle",icon:"save",onClick:this.handlePrivilegeSave,disabled:void 0==this.props.activeRole.id}))),s.a.createElement(v,{style:{height:"100%",overflowY:"auto"}},s.a.createElement(h.t,{theme:this.state.theme,onSelect:function(t){return e.handlePrivilegeItemSelected(t)},mode:"inline"},this.props.privilegeTreeSource.map(function(t,r){return s.a.createElement(k,{key:r,title:s.a.createElement("span",null,s.a.createElement(h.p,{type:e.getAppIcon(t.original)}),s.a.createElement("span",null,t.name))},t.children.map(function(t){return s.a.createElement(y,{key:t.key,title:t.name},t.children.map(function(t){return s.a.createElement(h.t.Item,{key:t.key},s.a.createElement(h.j,{disabled:void 0==e.props.activeRole.id,key:t.key,checked:void 0!=e.props.checkPrivileges.checkkeys.find(function(e){return e==t.key}),original:t.original,onChange:function(t){return e.privilegeItemCheckChange(t)}})," ",t.name)}))}))}))))),s.a.createElement(h.k,{span:12,style:{height:"100%"}},s.a.createElement(h.s,{style:{height:"100%"}},s.a.createElement(f,null,"\u7ec4\u7ec7\u6743\u9650"),s.a.createElement(v,{style:{height:"100%",overflowY:"auto"}},s.a.createElement(h.j,{disabled:this.state.privilegeOrgTreeDisabled,value:"88888888",checked:this.state.allChecked,onChange:function(t){return e.handleOrgPrivilegeTypeChecked(t)}},"\u5168\u90e8"),this.state.privilegeOrgTreeShow?s.a.createElement(h.j,{disabled:this.state.privilegeOrgTreeDisabled,checked:this.state.curOrgChecked,value:"00000000",onChange:function(t){return e.handleOrgPrivilegeTypeChecked(t)}},"\u672c\u7ec4\u7ec7"):null,this.state.privilegeOrgTreeShow?s.a.createElement(h.j,{disabled:this.state.privilegeOrgTreeDisabled,checked:this.state.filialeChecked,value:"11111111",onChange:function(t){return e.handleOrgPrivilegeTypeChecked(t)}},"\u5206\u516c\u53f8"):null,this.state.privilegeOrgTreeShow?s.a.createElement(h.I,{checkable:!this.state.privilegeOrgTreeDisabled,defaultCheckedKeys:r,checkStrictly:!0,onCheck:function(t,r){return e.handleOrgOnchecked(t,r)},loadData:this.onOrgTreeLoadData},function e(t){return t.map(function(t){return t.children&&t.children.length?s.a.createElement(b,{key:t.key,title:t.name,original:t.original},e(t.children)):s.a.createElement(b,{key:t.key,title:t.name,original:t.original,isLeaf:t.isLeaf})})}(this.props.permissionOrgTree.AddRolePermissionTree)):null)))),s.a.createElement(u.a,null))))))}}]),t}(c.Component);t.default=Object(p.b)(l,o)(E)},2068:function(e,t,r){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==typeof t&&"function"!==typeof t?e:t}function a(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e){return{activeRole:e.role.activeRole,operInfo:e.role.operInfo,roleSource:e.role.roleSource,treeSource:e.org.treeSource,permissionOrgTree:e.org.permissionOrgTree}}function o(e){return{dispatch:e}}var c=r(92),s=r(0),p=r.n(s),h=r(46),d=r(1281),u=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),g=h.o.Item,m=h.J.TreeNode,f=h.A.Option,v=function(e){function t(){var e,r,a,l;i(this,t);for(var o=arguments.length,c=Array(o),s=0;s<o;s++)c[s]=arguments[s];return r=a=n(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),a.state={dialogTitle:"",visible:!1,roleInfo:{},roleType:"Normal"},a.handleOk=function(e){e.preventDefault();var t=a.props.operInfo.operType;a.props.form.validateFields(function(e,r){if(!e){console.log("Received values of form: ",r);var i="POST";"add"!=t&&(i="PUT",r=Object.assign({},a.props.activeRole,r)),a.props.dispatch(Object(d.P)({method:i,data:r}))}})},a.handleCancel=function(e){a.props.dispatch(Object(d.I)())},a.handleOrgSelected=function(e){console.log("")},a.handleRoleTypeChange=function(e){a.setState({roleType:"Normal"})},l=r,n(a,l)}return a(t,e),u(t,[{key:"componentWillReceiveProps",value:function(e){var t=e.operInfo,r=t.operType,i=(t.result,e.activeRole);"edit"==r?this.setState({visible:!0,dialogTitle:"\u89d2\u8272\u7f16\u8f91",roleInfo:i}):"add"==r?this.setState({visible:!0,dialogTitle:"\u89d2\u8272\u65b0\u589e",roleInfo:{}}):(this.props.form.resetFields(),this.setState({visible:!1}))}},{key:"render",value:function(){var e=this.props.form.getFieldDecorator,t={labelCol:{span:6},wrapperCol:{span:14}},r=function e(t){return t.map(function(t){return t.children?p.a.createElement(m,{title:t.name,key:t.key,value:t.key},e(t.children)):p.a.createElement(m,{title:t.name,key:t.key,value:t.key,isLeaf:t.isLeaf})})}(this.props.treeSource);"Normal"===this.state.roleType?this.props.permissionOrgTree.AddNormalRoleTree:this.props.permissionOrgTree.AddPublicRoleTree;return p.a.createElement(h.u,{width:600,title:this.state.dialogTitle,maskClosable:!1,visible:this.state.visible,onOk:this.handleOk,onCancel:this.handleCancel},p.a.createElement(h.z,null,p.a.createElement(h.k,{span:12},p.a.createElement(g,Object.assign({},t,{label:p.a.createElement("span",null,"\u89d2\u8272\u540d\u79f0")}),e("name",{initialValue:this.state.roleInfo.name,rules:[{required:!0,message:"\u8bf7\u8f93\u5165\u89d2\u8272\u540d\u79f0!"}]})(p.a.createElement(h.q,{style:{float:"left"}}))))),p.a.createElement(h.z,null,p.a.createElement(h.k,{span:12},p.a.createElement(g,Object.assign({},t,{label:p.a.createElement("span",null,"\u89d2\u8272\u7c7b\u578b")}),e("type",{initialValue:this.state.roleInfo.type||"Normal",rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u89d2\u8272\u7c7b\u578b!"}]})(p.a.createElement(h.A,{style:{width:"100%"},onChange:this.handleRoleTypeChange},p.a.createElement(f,{value:"Normal"},"\u666e\u901a"),p.a.createElement(f,{value:"Public"},"\u516c\u5171")))))),p.a.createElement(h.z,null,p.a.createElement(h.k,{span:12},p.a.createElement(g,Object.assign({},t,{label:p.a.createElement("span",null,"\u6240\u5c5e\u90e8\u95e8")}),e("organizationId",{initialValue:this.state.roleInfo.organizationId,rules:[{required:!0,message:"\u8bf7\u9009\u62e9\u6240\u5c5e\u90e8\u95e8!"}]})(p.a.createElement(h.J,{style:{width:300},dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:this.props.permissionOrgTree.orgTreeSource,placeholder:"\u8bf7\u9009\u62e9\u6240\u5c5e\u90e8\u95e8"},r))))))}}]),t}(s.Component),k=h.o.create()(v);t.a=Object(c.b)(l,o)(k)}});
//# sourceMappingURL=31.fa7f1456.chunk.js.map